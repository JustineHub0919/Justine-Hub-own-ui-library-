--// Kaze UI Base
--// Window System (PC + Mobile)
--// Added: Strict Texture ID Sanitizer + 60x60 Minimize ImageButton (draggable, ZIndex 999)

local KazeUI = {}
KazeUI.__index = KazeUI

--// Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local LP = Players.LocalPlayer

--// Create ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KazeUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = LP:WaitForChild("PlayerGui")

--// UIScale for consistent scaling across devices
local UIScale = Instance.new("UIScale")
UIScale.Parent = ScreenGui

local function UpdateScale()
	local size = workspace.CurrentCamera.ViewportSize
	if size.X < 600 then
		UIScale.Scale = math.clamp(size.X / 800, 0.5, 1)
	else
		UIScale.Scale = math.clamp(size.X / 1920, 0.6, 1)
	end
end
UpdateScale()
workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(UpdateScale)

--// Texture ID Sanitizer
-- Accepts strings like "rbxassetid://123", "Rbxtextureid://123", "123", etc.
-- Extracts digits with string.gsub(id, "%D", "") and returns "rbxassetid://<digits>" or "" if none found.
local function FormatImage(id)
	if not id then return "" end
	id = tostring(id)
	local clean = string.gsub(id, "%D", "") -- keep only digits
	if clean == "" then return "" end
	return "rbxassetid://" .. clean
end

--// Drag Function (works with Mouse and Touch)
local DraggableCache = setmetatable({}, {__mode = "k"})
local function MakeDraggable(dragPart, targetPart)
	-- prevent double-binding / duplicate connections for same dragPart
	if DraggableCache[dragPart] then return end
	DraggableCache[dragPart] = true

	local dragging = false
	local dragInput, dragStart, startPos

	local function update(input)
		if not dragStart or not startPos then return end
		local delta = input.Position - dragStart
		targetPart.Position = UDim2.new(
			startPos.X.Scale, startPos.X.Offset + delta.X,
			startPos.Y.Scale, startPos.Y.Offset + delta.Y
		)
	end

	dragPart.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = targetPart.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
					dragInput = nil
				end
			end)
		end
	end)

	dragPart.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)

	UIS.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			update(input)
		end
	end)
end

--// CREATE WINDOW
function KazeUI:CreateWindow(config)
	config = config or {}

	-- Main Config
	local Title = config.Title or "Kaze UI"
	local Author = config.Author or "Unknown"
	local Version = config.Version or "1.0"
	local MainIcon = FormatImage(config.Icon or "6031763447")

	-- Open Button Config (ENFORCED to 60x60 for mobile playability)
	local OpenIcon = FormatImage((config.OpenButton and config.OpenButton.Icon) or config.Icon or "6031763447")
	-- Enforce exact 60x60 size (UDim2.fromOffset) as requested
	local MiniButtonSize = UDim2.fromOffset(60, 60)

	local Callback = config.Callback

	--// Main Window
	local Window = Instance.new("Frame")
	Window.Name = "MainWindow"
	Window.Size = UDim2.fromOffset(650, 420)
	Window.Position = UDim2.fromScale(0.5, 0.5)
	Window.AnchorPoint = Vector2.new(0.5, 0.5)
	Window.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
	Window.BorderSizePixel = 0
	Window.Parent = ScreenGui
	Window.ClipsDescendants = true
	Instance.new("UICorner", Window).CornerRadius = UDim.new(0, 14)

	local WindowStroke = Instance.new("UIStroke")
	WindowStroke.Color = Color3.fromRGB(0, 160, 255)
	WindowStroke.Thickness = 2.5 -- neon thickness
	WindowStroke.Parent = Window

	spawn(function()
		while Window.Parent do
			local t = TweenService:Create(WindowStroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {Color = Color3.fromRGB(0, 255, 255)})
			t:Play()
			break
		end
	end)

	--// Top Bar
	local TopBar = Instance.new("Frame")
	TopBar.Name = "TopBar"
	TopBar.Size = UDim2.new(1, 0, 0, 56)
	TopBar.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
	TopBar.BorderSizePixel = 0
	TopBar.Parent = Window
	Instance.new("UICorner", TopBar).CornerRadius = UDim.new(0, 14)
	MakeDraggable(TopBar, Window)

	local Icon = Instance.new("ImageLabel")
	Icon.Size = UDim2.fromOffset(32, 32)
	Icon.Position = UDim2.fromOffset(14, 12)
	Icon.BackgroundTransparency = 1
	Icon.Image = MainIcon
	Icon.Parent = TopBar
	Instance.new("UICorner", Icon).CornerRadius = UDim.new(1, 0)

	local TitleLabel = Instance.new("TextLabel")
	TitleLabel.Size = UDim2.new(1, -160, 0, 22)
	TitleLabel.Position = UDim2.fromOffset(56, 8)
	TitleLabel.BackgroundTransparency = 1
	TitleLabel.Text = Title
	TitleLabel.TextColor3 = Color3.fromRGB(235, 235, 235)
	TitleLabel.Font = Enum.Font.GothamBold
	TitleLabel.TextSize = 16
	TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
	TitleLabel.Parent = TopBar

	local SubLabel = Instance.new("TextLabel")
	SubLabel.Size = UDim2.new(1, -160, 0, 18)
	SubLabel.Position = UDim2.fromOffset(56, 30)
	SubLabel.BackgroundTransparency = 1
	SubLabel.Text = Author .. " | v" .. Version
	SubLabel.TextColor3 = Color3.fromRGB(160, 160, 160)
	SubLabel.Font = Enum.Font.Gotham
	SubLabel.TextSize = 13
	SubLabel.TextXAlignment = Enum.TextXAlignment.Left
	SubLabel.Parent = TopBar

	local Minimize = Instance.new("TextButton")
	Minimize.Size = UDim2.fromOffset(36, 36)
	Minimize.Position = UDim2.new(1, -88, 0.5, -18)
	Minimize.Text = "—"
	Minimize.Font = Enum.Font.GothamBold
	Minimize.TextSize = 20
	Minimize.TextColor3 = Color3.fromRGB(220, 220, 220)
	Minimize.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
	Minimize.Parent = TopBar
	Instance.new("UICorner", Minimize).CornerRadius = UDim.new(1, 0)

	local Close = Instance.new("TextButton")
	Close.Size = UDim2.fromOffset(36, 36)
	Close.Position = UDim2.new(1, -44, 0.5, -18)
	Close.Text = "✕"
	Close.Font = Enum.Font.GothamBold
	Close.TextSize = 18
	Close.TextColor3 = Color3.fromRGB(255, 90, 90)
	Close.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
	Close.Parent = TopBar
	Instance.new("UICorner", Close).CornerRadius = UDim.new(1, 0)

	local Content = Instance.new("Frame")
	Content.Position = UDim2.fromOffset(0, 56)
	Content.Size = UDim2.new(1, 0, 1, -56)
	Content.BackgroundTransparency = 1
	Content.Parent = Window

	--// MINI BUTTON (60x60 Square ImageButton)
	local MiniButton = Instance.new("ImageButton")
	MiniButton.Name = "MiniButton"
	MiniButton.Size = MiniButtonSize -- enforced exact 60x60
	-- Default position (can be dragged by user)
	MiniButton.Position = UDim2.fromScale(0.1, 0.1)
	MiniButton.BackgroundColor3 = Color3.fromRGB(20, 20, 25) -- solid background
	MiniButton.BorderSizePixel = 0
	MiniButton.Visible = false
	MiniButton.Parent = ScreenGui -- parent directly to ScreenGui to remain visible when Window hidden
	MiniButton.ZIndex = 999 -- ensure never hidden behind other UI
	MiniButton.ScaleType = Enum.ScaleType.Slice
	MiniButton.SliceCenter = Rect.new(4,4,60,60)

	local miniUICorner = Instance.new("UICorner")
	miniUICorner.CornerRadius = UDim.new(0, 12)
	miniUICorner.Parent = MiniButton

	-- Padding so the icon can be large but not cover the neon outline
	local miniPadding = Instance.new("UIPadding")
	miniPadding.PaddingTop = UDim.new(0, 4)
	miniPadding.PaddingBottom = UDim.new(0, 4)
	miniPadding.PaddingLeft = UDim.new(0, 4)
	miniPadding.PaddingRight = UDim.new(0, 4)
	miniPadding.Parent = MiniButton

	local MiniIcon = Instance.new("ImageLabel")
	-- Fill the padded area and center the icon
	MiniIcon.Size = UDim2.fromScale(1, 1)
	MiniIcon.Position = UDim2.fromScale(0.5, 0.5)
	MiniIcon.AnchorPoint = Vector2.new(0.5, 0.5)
	MiniIcon.BackgroundTransparency = 1
	MiniIcon.Image = OpenIcon
	MiniIcon.Parent = MiniButton
	MiniIcon.ZIndex = 1000

	local MiniStroke = Instance.new("UIStroke")
	MiniStroke.Color = Color3.fromRGB(0, 160, 255)
	MiniStroke.Thickness = 2.5 -- neon thickness
	-- ensure the glow stays on the outside edge
	MiniStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	MiniStroke.Parent = MiniButton
	MiniStroke.LineJoinMode = Enum.LineJoinMode.Bevel

	spawn(function()
		while MiniButton.Parent do
			local t = TweenService:Create(MiniStroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {Color = Color3.fromRGB(0, 255, 255)})
			t:Play()
			break
		end
	end)

	-- Make both TopBar and MiniButton draggable (MiniButton draggable by itself)
	MakeDraggable(TopBar, Window)
	MakeDraggable(MiniButton, MiniButton)

	-- Minimize behavior: hide Window, show 60x60 ImageButton (parented to ScreenGui)
	Minimize.MouseButton1Click:Connect(function()
		Window.Visible = false
		-- show the standalone 60x60 ImageButton (ensure exact size)
		MiniButton.Visible = true
		MiniButton.Size = UDim2.fromOffset(0, 0)
		-- fixed: use EasingStyle.Back and EasingDirection.Out instead of non-existent BackOut
		TweenService:Create(MiniButton, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = MiniButtonSize}):Play()
	end)

	-- Clicking the 60x60 ImageButton restores the window
	MiniButton.MouseButton1Click:Connect(function()
		MiniButton.Visible = false
		Window.Visible = true
		-- animate window open from 0 size to the main size
		Window.Size = UDim2.fromOffset(0, 0)
		-- fixed: use EasingStyle.Back and EasingDirection.Out instead of non-existent BackOut
		TweenService:Create(Window, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.fromOffset(650, 420)}):Play()
	end)

	-- Close Logic with confirmation overlay
	local function ShowCloseConfirm()
		Minimize.Active = false
		Close.Active = false
		local Overlay = Instance.new("Frame")
		Overlay.Size = UDim2.new(1, 0, 1, 0)
		Overlay.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
		Overlay.BackgroundTransparency = 0.6
		Overlay.ZIndex = 20
		Overlay.Parent = Window

		local ConfirmWindow = Instance.new("Frame")
		ConfirmWindow.Size = UDim2.fromOffset(350, 150)
		ConfirmWindow.AnchorPoint = Vector2.new(0.5, 0.5)
		ConfirmWindow.Position = UDim2.fromScale(0.5, 0.5)
		ConfirmWindow.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
		ConfirmWindow.ZIndex = 21
		ConfirmWindow.Parent = Overlay
		Instance.new("UICorner", ConfirmWindow).CornerRadius = UDim.new(0, 12)

		local ConfirmText = Instance.new("TextLabel")
		ConfirmText.Size = UDim2.new(1, -32, 0, 48)
		ConfirmText.Position = UDim2.fromOffset(16, 20)
		ConfirmText.BackgroundTransparency = 1
		ConfirmText.Text = "Are you sure you want to close the UI?"
		ConfirmText.TextColor3 = Color3.fromRGB(230, 230, 230)
		ConfirmText.Font = Enum.Font.GothamBold
		ConfirmText.TextSize = 18
		ConfirmText.TextWrapped = true
		ConfirmText.ZIndex = 22
		ConfirmText.Parent = ConfirmWindow

		local ButtonsFrame = Instance.new("Frame")
		ButtonsFrame.Size = UDim2.new(1, 0, 0, 40)
		ButtonsFrame.Position = UDim2.new(0, 0, 1, -20)
		ButtonsFrame.AnchorPoint = Vector2.new(0, 1)
		ButtonsFrame.BackgroundTransparency = 1
		ButtonsFrame.ZIndex = 22
		ButtonsFrame.Parent = ConfirmWindow

		local layout = Instance.new("UIListLayout")
		layout.Parent = ButtonsFrame
		layout.FillDirection = Enum.FillDirection.Horizontal
		layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
		layout.Padding = UDim.new(0, 16)

		local ConfirmBtn = Instance.new("TextButton")
		ConfirmBtn.Size = UDim2.new(0, 120, 0, 36)
		ConfirmBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
		ConfirmBtn.Text = "Confirm"
		ConfirmBtn.TextColor3 = Color3.fromRGB(230, 230, 230)
		ConfirmBtn.Font = Enum.Font.GothamBold
		ConfirmBtn.TextSize = 16
		ConfirmBtn.ZIndex = 23
		ConfirmBtn.Parent = ButtonsFrame
		Instance.new("UICorner", ConfirmBtn).CornerRadius = UDim.new(0, 8)

		local CancelBtn = Instance.new("TextButton")
		CancelBtn.Size = UDim2.new(0, 120, 0, 36)
		CancelBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
		CancelBtn.Text = "Cancel"
		CancelBtn.TextColor3 = Color3.fromRGB(220, 220, 220)
		CancelBtn.Font = Enum.Font.GothamBold
		CancelBtn.TextSize = 16
		CancelBtn.ZIndex = 23
		CancelBtn.Parent = ButtonsFrame
		Instance.new("UICorner", CancelBtn).CornerRadius = UDim.new(0, 8)

		ConfirmBtn.MouseButton1Click:Connect(function()
			ScreenGui:Destroy()
		end)
		CancelBtn.MouseButton1Click:Connect(function()
			Overlay:Destroy()
			Minimize.Active = true
			Close.Active = true
		end)
	end
	Close.MouseButton1Click:Connect(ShowCloseConfirm)

	if typeof(Callback) == "function" then
		pcall(Callback)
	end

	-- Return main UI handles (including the standalone MiniButton)
	-- NOTE: extended API with tab/element creation will be appended and returned below
	-- initial return values preserved
	-- return {Window = Window, Content = Content, Icon = Icon, MiniButton = MiniButton}

	-- ========================================================================
	-- Add: Tab System + Element Creators
	-- ========================================================================

	-- Tabs Panel (left) and Pages Holder (right) inside Content
	local TabsPanel = Instance.new("Frame")
	TabsPanel.Name = "TabsPanel"
	TabsPanel.Size = UDim2.new(0, 180, 1, 0)
	TabsPanel.Position = UDim2.new(0, 0, 0, 0)
	TabsPanel.BackgroundTransparency = 1
	TabsPanel.Parent = Content

	local TabsList = Instance.new("ScrollingFrame")
	TabsList.Name = "TabsList"
	TabsList.Size = UDim2.new(1, 0, 1, 0)
	TabsList.CanvasSize = UDim2.new(0, 0, 0, 0)
	TabsList.ScrollBarThickness = 6
	TabsList.BackgroundTransparency = 1
	TabsList.VerticalScrollBarInset = Enum.ScrollBarInset.Always
	TabsList.Parent = TabsPanel

	local tabsLayout = Instance.new("UIListLayout")
	tabsLayout.Parent = TabsList
	tabsLayout.SortOrder = Enum.SortOrder.LayoutOrder
	tabsLayout.Padding = UDim.new(0, 8)

	local tabsPadding = Instance.new("UIPadding")
	tabsPadding.Parent = TabsList
	tabsPadding.PaddingTop = UDim.new(0, 8)
	tabsPadding.PaddingLeft = UDim.new(0, 8)
	tabsPadding.PaddingRight = UDim.new(0, 8)
	tabsPadding.PaddingBottom = UDim.new(0, 8)

	-- Pages holder
	local PagesHolder = Instance.new("Frame")
	PagesHolder.Name = "PagesHolder"
	PagesHolder.Size = UDim2.new(1, -180, 1, 0)
	PagesHolder.Position = UDim2.new(0, 180, 0, 0)
	PagesHolder.BackgroundTransparency = 1
	PagesHolder.Parent = Content

	-- Helper to update tabs list canvas size
	local function updateTabsCanvas()
		local abs = tabsLayout.AbsoluteContentSize
		TabsList.CanvasSize = UDim2.new(0, 0, 0, abs.Y + 16)
	end
	tabsLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateTabsCanvas)

	-- function: create a tab and return helpers to create elements inside it
	local function CreateTab(tabName, tabIcon)
		tabIcon = FormatImage(tabIcon or "")
		local TabButton = Instance.new("TextButton")
		TabButton.Name = "Tab_" .. tabName
		TabButton.Size = UDim2.new(1, 0, 0, 42)
		TabButton.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
		TabButton.BorderSizePixel = 0
		TabButton.Text = tabName
		TabButton.TextColor3 = Color3.fromRGB(220, 220, 220)
		TabButton.Font = Enum.Font.GothamBold
		TabButton.TextSize = 14
		TabButton.TextXAlignment = Enum.TextXAlignment.Left
		TabButton.Parent = TabsList
		Instance.new("UICorner", TabButton).CornerRadius = UDim.new(0, 8)

		local iconLabel
		if tabIcon ~= "" then
			iconLabel = Instance.new("ImageLabel")
			iconLabel.Image = tabIcon
			iconLabel.BackgroundTransparency = 1
			iconLabel.Size = UDim2.fromOffset(28, 28)
			iconLabel.Position = UDim2.fromOffset(8, 7)
			iconLabel.Parent = TabButton
			Instance.new("UICorner", iconLabel).CornerRadius = UDim.new(1, 0)
			-- shift text to the right
			TabButton.Padding = TabButton.Padding or Instance.new("UIPadding", TabButton)
			TabButton.Padding.PaddingLeft = UDim.new(0, 42)
			TabButton.TextXAlignment = Enum.TextXAlignment.Left
		else
			-- small padding to left
			TabButton.Padding = TabButton.Padding or Instance.new("UIPadding", TabButton)
			TabButton.Padding.PaddingLeft = UDim.new(0, 12)
		end

		-- Page frame for content
		local Page = Instance.new("Frame")
		Page.Name = "Page_" .. tabName
		Page.Size = UDim2.new(1, 0, 1, 0)
		Page.Position = UDim2.new(0, 0, 0, 0)
		Page.BackgroundTransparency = 1
		Page.Visible = false
		Page.Parent = PagesHolder

		-- Scrollable content inside page
		local ContentScroll = Instance.new("ScrollingFrame")
		ContentScroll.Size = UDim2.new(1, 0, 1, 0)
		ContentScroll.Position = UDim2.new(0, 0, 0, 0)
		ContentScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
		ContentScroll.ScrollBarThickness = 10
		ContentScroll.BackgroundTransparency = 1
		ContentScroll.Parent = Page

		local contentLayout = Instance.new("UIListLayout")
		contentLayout.Parent = ContentScroll
		contentLayout.SortOrder = Enum.SortOrder.LayoutOrder
		contentLayout.Padding = UDim.new(0, 8)

		local contentPadding = Instance.new("UIPadding")
		contentPadding.Parent = ContentScroll
		contentPadding.PaddingTop = UDim.new(0, 12)
		contentPadding.PaddingLeft = UDim.new(0, 12)
		contentPadding.PaddingRight = UDim.new(0, 12)
		contentPadding.PaddingBottom = UDim.new(0, 12)

		local function updateContentCanvas()
			local abs = contentLayout.AbsoluteContentSize
			ContentScroll.CanvasSize = UDim2.new(0, 0, 0, abs.Y + 16)
		end
		contentLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateContentCanvas)

		-- Activate tab on click
		TabButton.MouseButton1Click:Connect(function()
			-- hide other pages and un-highlight other tabs
			for _, child in ipairs(TabsList:GetChildren()) do
				if child:IsA("TextButton") then
					child.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
				end
			end
			for _, p in ipairs(PagesHolder:GetChildren()) do
				if p:IsA("Frame") then
					p.Visible = false
				end
			end
			TabButton.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
			Page.Visible = true
		end)

		-- Default: if first tab created, activate it
		if #PagesHolder:GetChildren() == 0 then
			TabButton.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
			Page.Visible = true
		end

		-- ============================
		-- Element Creator Functions
		-- ============================
		local tabAPI = {}

		function tabAPI:AddLabel(text)
			local frame = Instance.new("Frame")
			frame.Size = UDim2.new(1, 0, 0, 24)
			frame.BackgroundTransparency = 1
			frame.Parent = ContentScroll

			local lbl = Instance.new("TextLabel")
			lbl.Size = UDim2.new(1, 0, 1, 0)
			lbl.BackgroundTransparency = 1
			lbl.Text = text or ""
			lbl.TextColor3 = Color3.fromRGB(220, 220, 220)
			lbl.Font = Enum.Font.Gotham
			lbl.TextSize = 14
			lbl.TextXAlignment = Enum.TextXAlignment.Left
			lbl.Parent = frame

			return lbl
		end

		function tabAPI:AddButton(text, callback)
			local btn = Instance.new("TextButton")
			btn.Size = UDim2.new(1, 0, 0, 36)
			btn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
			btn.Text = text or "Button"
			btn.TextColor3 = Color3.fromRGB(230, 230, 230)
			btn.Font = Enum.Font.GothamBold
			btn.TextSize = 14
			btn.Parent = ContentScroll
			Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
			btn.MouseButton1Click:Connect(function()
				if type(callback) == "function" then
					pcall(callback)
				end
			end)
			return btn
		end

		function tabAPI:AddToggle(text, default, callback)
			local container = Instance.new("Frame")
			container.Size = UDim2.new(1, 0, 0, 36)
			container.BackgroundTransparency = 1
			container.Parent = ContentScroll

			local label = Instance.new("TextLabel")
			label.Size = UDim2.new(1, -46, 1, 0)
			label.Position = UDim2.fromOffset(6, 0)
			label.BackgroundTransparency = 1
			label.Text = text or "Toggle"
			label.TextColor3 = Color3.fromRGB(220, 220, 220)
			label.Font = Enum.Font.Gotham
			label.TextSize = 14
			label.TextXAlignment = Enum.TextXAlignment.Left
			label.Parent = container

			local toggle = Instance.new("TextButton")
			toggle.Size = UDim2.new(0, 36, 0, 24)
			toggle.Position = UDim2.new(1, -42, 0.5, -12)
			toggle.BackgroundColor3 = default and Color3.fromRGB(0, 170, 255) or Color3.fromRGB(45, 45, 50)
			toggle.Parent = container
			toggle.Text = ""
			Instance.new("UICorner", toggle).CornerRadius = UDim.new(0, 6)

			local state = default and true or false
			toggle.MouseButton1Click:Connect(function()
				state = not state
				toggle.BackgroundColor3 = state and Color3.fromRGB(0, 170, 255) or Color3.fromRGB(45, 45, 50)
				if type(callback) == "function" then
					pcall(callback, state)
				end
			end)
			return {
				Frame = container,
				Set = function(v)
					state = not not v
					toggle.BackgroundColor3 = state and Color3.fromRGB(0, 170, 255) or Color3.fromRGB(45, 45, 50)
				end,
				Get = function()
					return state
				end
			}
		end

		function tabAPI:AddTextbox(placeholder, callback)
			local box = Instance.new("TextBox")
			box.Size = UDim2.new(1, 0, 0, 34)
			box.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
			box.ClearTextOnFocus = false
			box.PlaceholderText = placeholder or ""
			box.Text = ""
			box.TextColor3 = Color3.fromRGB(230, 230, 230)
			box.Font = Enum.Font.Gotham
			box.TextSize = 14
			box.Parent = ContentScroll
			Instance.new("UICorner", box).CornerRadius = UDim.new(0, 6)
			box.FocusLost:Connect(function(enter)
				if enter and type(callback) == "function" then
					pcall(callback, box.Text)
				end
			end)
			return box
		end

		function tabAPI:AddSlider(text, min, max, default, callback)
			min = min or 0
			max = max or 100
			default = default or min
			local container = Instance.new("Frame")
			container.Size = UDim2.new(1, 0, 0, 48)
			container.BackgroundTransparency = 1
			container.Parent = ContentScroll

			local label = Instance.new("TextLabel")
			label.Size = UDim2.new(1, -64, 0, 18)
			label.Position = UDim2.fromOffset(6, 4)
			label.BackgroundTransparency = 1
			label.Text = (text or "Slider") .. " - " .. tostring(default)
			label.TextColor3 = Color3.fromRGB(220, 220, 220)
			label.Font = Enum.Font.Gotham
			label.TextSize = 14
			label.TextXAlignment = Enum.TextXAlignment.Left
			label.Parent = container

			local barBG = Instance.new("Frame")
			barBG.Size = UDim2.new(1, -12, 0, 12)
			barBG.Position = UDim2.fromOffset(6, 26)
			barBG.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
			barBG.Parent = container
			Instance.new("UICorner", barBG).CornerRadius = UDim.new(0, 6)

			local fill = Instance.new("Frame")
			fill.Size = UDim2.new( (default - min) / math.max(1, max - min), 0, 1, 0)
			fill.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
			fill.Parent = barBG
			Instance.new("UICorner", fill).CornerRadius = UDim.new(0, 6)

			local dragging = false
			local function updateValueFromInput(input)
				local abs = barBG.AbsoluteSize.X
				local relative = math.clamp((input.Position.X - barBG.AbsolutePosition.X) / math.max(1, abs), 0, 1)
				local value = min + (max - min) * relative
				local rounded = math.floor(value * 100) / 100
				fill.Size = UDim2.new(relative, 0, 1, 0)
				label.Text = (text or "Slider") .. " - " .. tostring(rounded)
				if type(callback) == "function" then
					pcall(callback, rounded)
				end
			end

			barBG.InputBegan:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
					dragging = true
					updateValueFromInput(input)
				end
			end)
			barBG.InputEnded:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
					dragging = false
				end
			end)
			UIS.InputChanged:Connect(function(input)
				if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
					updateValueFromInput(input)
				end
			end)

			return {
				Frame = container,
				Set = function(v)
					local relative = math.clamp((v - min) / math.max(1, max - min), 0, 1)
					fill.Size = UDim2.new(relative, 0, 1, 0)
					label.Text = (text or "Slider") .. " - " .. tostring(v)
				end
			}
		end

		function tabAPI:AddDropdown(text, options, callback)
			options = options or {}
			local container = Instance.new("Frame")
			container.Size = UDim2.new(1, 0, 0, 36)
			container.BackgroundTransparency = 1
			container.Parent = ContentScroll

			local btn = Instance.new("TextButton")
			btn.Size = UDim2.new(1, 0, 1, 0)
			btn.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
			btn.Text = text or "Select"
			btn.TextColor3 = Color3.fromRGB(220, 220, 220)
			btn.Font = Enum.Font.Gotham
			btn.TextSize = 14
			btn.Parent = container
			Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)

			local list = Instance.new("Frame")
			list.Size = UDim2.new(1, 0, 0, 0)
			list.Position = UDim2.new(0, 0, 1, 8)
			list.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
			list.ClipsDescendants = true
			list.Parent = container
			Instance.new("UICorner", list).CornerRadius = UDim.new(0, 6)

			local listScroll = Instance.new("ScrollingFrame")
			listScroll.Size = UDim2.new(1, 0, 1, 0)
			listScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
			listScroll.BackgroundTransparency = 1
			listScroll.ScrollBarThickness = 6
			listScroll.Parent = list

			local listLayout = Instance.new("UIListLayout")
			listLayout.Parent = listScroll
			listLayout.Padding = UDim.new(0, 4)

			local function updateListSize()
				local abs = listLayout.AbsoluteContentSize
				list.Size = UDim2.new(1, 0, 0, math.clamp(abs.Y + 12, 0, 200))
				listScroll.CanvasSize = UDim2.new(0, 0, 0, abs.Y)
			end
			listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateListSize)

			local open = false
			btn.MouseButton1Click:Connect(function()
				open = not open
				if open then
					list.Visible = true
				else
					list.Visible = false
				end
			end)

			for _, opt in ipairs(options) do
				local opBtn = Instance.new("TextButton")
				opBtn.Size = UDim2.new(1, -12, 0, 28)
				opBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
				opBtn.Text = tostring(opt)
				opBtn.TextColor3 = Color3.fromRGB(220, 220, 220)
				opBtn.Font = Enum.Font.Gotham
				opBtn.TextSize = 14
				opBtn.Parent = listScroll
				Instance.new("UICorner", opBtn).CornerRadius = UDim.new(0, 6)
				opBtn.MouseButton1Click:Connect(function()
					btn.Text = tostring(opt)
					open = false
					list.Visible = false
					if type(callback) == "function" then
						pcall(callback, opt)
					end
				end)
			end

			return {
				Frame = container,
				SetOptions = function(newOptions)
					for _, c in ipairs(listScroll:GetChildren()) do
						if c:IsA("TextButton") then c:Destroy() end
					end
					for _, opt in ipairs(newOptions) do
						local opBtn = Instance.new("TextButton")
						opBtn.Size = UDim2.new(1, -12, 0, 28)
						opBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
						opBtn.Text = tostring(opt)
						opBtn.TextColor3 = Color3.fromRGB(220, 220, 220)
						opBtn.Font = Enum.Font.Gotham
						opBtn.TextSize = 14
						opBtn.Parent = listScroll
						Instance.new("UICorner", opBtn).CornerRadius = UDim.new(0, 6)
						opBtn.MouseButton1Click:Connect(function()
							btn.Text = tostring(opt)
							list.Visible = false
							if type(callback) == "function" then
								pcall(callback, opt)
							end
						end)
					end
					updateListSize()
				end
			}
		end

		function tabAPI:AddSeparator()
			local sep = Instance.new("Frame")
			sep.Size = UDim2.new(1, 0, 0, 10)
			sep.BackgroundTransparency = 1
			sep.Parent = ContentScroll
			local line = Instance.new("Frame")
			line.Size = UDim2.new(1, 0, 0, 1)
			line.Position = UDim2.fromOffset(0, 6)
			line.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
			line.Parent = sep
			return sep
		end

		function tabAPI:AddProgressBar(text, value)
			local container = Instance.new("Frame")
			container.Size = UDim2.new(1, 0, 0, 36)
			container.BackgroundTransparency = 1
			container.Parent = ContentScroll

			local label = Instance.new("TextLabel")
			label.Size = UDim2.new(1, -6, 0, 16)
			label.Position = UDim2.fromOffset(6, 0)
			label.BackgroundTransparency = 1
			label.Text = text or ""
			label.TextColor3 = Color3.fromRGB(220, 220, 220)
			label.Font = Enum.Font.Gotham
			label.TextSize = 14
			label.TextXAlignment = Enum.TextXAlignment.Left
			label.Parent = container

			local barBG = Instance.new("Frame")
			barBG.Size = UDim2.new(1, -12, 0, 12)
			barBG.Position = UDim2.fromOffset(6, 18)
			barBG.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
			barBG.Parent = container
			Instance.new("UICorner", barBG).CornerRadius = UDim.new(0, 6)

			local fill = Instance.new("Frame")
			fill.Size = UDim2.new(math.clamp(value or 0, 0, 1), 0, 1, 0)
			fill.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
			fill.Parent = barBG
			Instance.new("UICorner", fill).CornerRadius = UDim.new(0, 6)

			return {
				Set = function(v)
					fill.Size = UDim2.new(math.clamp(v, 0, 1), 0, 1, 0)
				end
			}
		end

		function tabAPI:AddImage(imageId, size)
			local img = Instance.new("ImageLabel")
			img.Size = size or UDim2.new(1, 0, 0, 120)
			img.BackgroundTransparency = 1
			img.Image = FormatImage(imageId or "")
			img.Parent = ContentScroll
			return img
		end

		function tabAPI:AddKeybind(text, defaultKey, callback)
			local container = Instance.new("Frame")
			container.Size = UDim2.new(1, 0, 0, 36)
			container.BackgroundTransparency = 1
			container.Parent = ContentScroll

			local label = Instance.new("TextLabel")
			label.Size = UDim2.new(1, -120, 1, 0)
			label.Position = UDim2.fromOffset(6, 0)
			label.BackgroundTransparency = 1
			label.Text = text or "Keybind"
			label.TextColor3 = Color3.fromRGB(220, 220, 220)
			label.Font = Enum.Font.Gotham
			label.TextSize = 14
			label.TextXAlignment = Enum.TextXAlignment.Left
			label.Parent = container

			local bindBtn = Instance.new("TextButton")
			bindBtn.Size = UDim2.new(0, 100, 0, 28)
			bindBtn.Position = UDim2.new(1, -110, 0.5, -14)
			bindBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
			bindBtn.Text = tostring(defaultKey or "...")
			bindBtn.TextColor3 = Color3.fromRGB(220, 220, 220)
			bindBtn.Font = Enum.Font.Gotham
			bindBtn.TextSize = 14
			bindBtn.Parent = container
			Instance.new("UICorner", bindBtn).CornerRadius = UDim.new(0, 6)

			local current = defaultKey
			local awaiting = false
			local conn

			bindBtn.MouseButton1Click:Connect(function()
				awaiting = true
				bindBtn.Text = "Press..."
				if conn then conn:Disconnect() end
				conn = UIS.InputBegan:Connect(function(input, gameProcessed)
					if gameProcessed then return end
					if input.UserInputType == Enum.UserInputType.Keyboard then
						current = input.KeyCode
						bindBtn.Text = tostring(current):gsub("Enum.KeyCode.", "")
						awaiting = false
						if type(callback) == "function" then
							pcall(callback, current)
						end
						if conn then conn:Disconnect() end
					end
				end)
			end)

			return {
				Get = function() return current end,
				Set = function(k) current = k bindBtn.Text = tostring(k) end
			}
		end

		-- expose the page and content scroll for advanced usage
		tabAPI.Page = Page
		tabAPI.ContentScroll = ContentScroll

		return tabAPI
	end

	-- Convenience: Create multiple tabs from a table
	local function CreateTabs(tabs)
		local results = {}
		for _, t in ipairs(tabs or {}) do
			results[#results + 1] = CreateTab(t.Name or "Tab", t.Icon)
		end
		return results
	end

	-- Build API to return
	local API = {
		Window = Window,
		Content = Content,
		Icon = Icon,
		MiniButton = MiniButton,
		CreateTab = CreateTab,
		CreateTabs = CreateTabs,
		TabsPanel = TabsPanel,
		PagesHolder = PagesHolder
	}

	return API
end

return KazeUI
