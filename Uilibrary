--[[ 
	ExecutorUI.lua
	Modern, reusable Roblox UI library (executor-style) with:
	- Window with Top Bar: Icon, Title, Author, Version, Minimize, Close
	- Unlimited Tabs -> Sections -> Elements
	- Elements: Button, Toggle, Dropdown, Slider, Textbox, Label/Paragraph, Keybind, Color Picker, Divider
	- Mobile + PC compatible, responsive scaling, draggable, smooth tweens, dark theme
	- Simple API for developers to create/remove tabs/sections/elements
	Usage: local UI = require(path.to.ExecutorUI); local win = UI:CreateWindow(config)
--]]

local ExecutorUI = {}
ExecutorUI.__index = ExecutorUI

-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local LP = Players.LocalPlayer

-- Helpers
local function FormatImage(id)
	if not id then return "" end
	id = tostring(id)
	local clean = string.gsub(id, "%D", "")
	if clean == "" then return "" end
	return "rbxassetid://" .. clean
end

local function Create(class, props)
	local obj = Instance.new(class)
	if props then
		for k, v in pairs(props) do
			if k ~= "Parent" then
				obj[k] = v
			end
		end
		if props.Parent then
			obj.Parent = props.Parent
		end
	end
	return obj
end

local function Tween(instance, properties, tweenInfo)
	tweenInfo = tweenInfo or TweenInfo.new(0.25, Enum.EasingStyle.Sine, Enum.EasingDirection.Out)
	return TweenService:Create(instance, tweenInfo, properties)
end

local function MakeDraggable(handle, target)
	local dragging, dragInput, dragStart, startPos
	local function update(input)
		if not dragStart or not startPos then return end
		local delta = input.Position - dragStart
		target.Position = UDim2.new(
			startPos.X.Scale, startPos.X.Offset + delta.X,
			startPos.Y.Scale, startPos.Y.Offset + delta.Y
		)
	end

	handle.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = target.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
					dragInput = nil
				end
			end)
		end
	end)
	handle.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)
	UIS.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			update(input)
		end
	end)
end

-- Build GUI container
local function BuildScreenGui(name)
	local ScreenGui = Instance.new("ScreenGui")
	ScreenGui.Name = name or "ExecutorUI"
	ScreenGui.ResetOnSpawn = false
	ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	ScreenGui.Parent = LP:WaitForChild("PlayerGui")

	-- UIScale for responsive design
	local UIScale = Instance.new("UIScale")
	UIScale.Parent = ScreenGui
	local function UpdateScale()
		local size = workspace.CurrentCamera.ViewportSize
		if size.X < 600 then
			UIScale.Scale = math.clamp(size.X / 800, 0.5, 1)
		else
			UIScale.Scale = math.clamp(size.X / 1920, 0.6, 1)
		end
	end
	UpdateScale()
	workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(UpdateScale)

	return ScreenGui
end

-- Theme colors
local THEME = {
	Background = Color3.fromRGB(18, 18, 22),
	Panel = Color3.fromRGB(24, 24, 28),
	TopBar = Color3.fromRGB(15, 15, 19),
	Accent = Color3.fromRGB(0, 160, 255),
	Text = Color3.fromRGB(230, 230, 230),
	Muted = Color3.fromRGB(150, 150, 160),
	Success = Color3.fromRGB(0, 200, 120),
	Warning = Color3.fromRGB(255, 120, 80),
}

-- Utility: create rounded frame with optional stroke & gradient
local function NiceFrame(parent, props)
	props = props or {}
	local frame = Create("Frame", {
		Parent = parent,
		BackgroundColor3 = props.Color or THEME.Panel,
		BorderSizePixel = 0,
		Size = props.Size or UDim2.new(1, 0, 0, 36),
		Position = props.Position,
		Name = props.Name or "NiceFrame",
	})
	local corner = Create("UICorner", {Parent = frame, CornerRadius = UDim.new(0, props.Radius or 10)})
	if props.Stroke then
		local stroke = Create("UIStroke", {Parent = frame, Color = props.StrokeColor or THEME.Accent, Thickness = props.StrokeThickness or 1.5})
		stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	end
	if props.Gradient then
		local g = Create("UIGradient", {Parent = frame})
		g.Color = ColorSequence.new(props.Gradient)
	end
	return frame
end

-- Main CreateWindow
function ExecutorUI:CreateWindow(config)
	config = config or {}
	local Title = config.Title or "Executor UI"
	local Author = config.Author or "Author"
	local Version = config.Version or "1.0"
	local IconId = FormatImage(config.Icon or "")

	-- Create ScreenGui
	local ScreenGui = BuildScreenGui("ExecutorUI_" .. (Title:gsub("%W","") ~= "" and Title or "UI"))

	-- Main window
	local Window = Create("Frame", {
		Parent = ScreenGui,
		Name = "MainWindow",
		Size = UDim2.fromOffset(780, 480),
		Position = UDim2.new(0.5, 0, 0.5, 0),
		AnchorPoint = Vector2.new(0.5, 0.5),
		BackgroundColor3 = THEME.Background,
		BorderSizePixel = 0,
	})
	Create("UICorner", {Parent = Window, CornerRadius = UDim.new(0, 14)})
	local WindowStroke = Create("UIStroke", {Parent = Window, Color = THEME.Accent, Thickness = 2})
	WindowStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	spawn(function()
		while Window.Parent do
			local t = TweenService:Create(WindowStroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {Color = Color3.fromRGB(0, 230, 255)})
			t:Play()
			break
		end
	end)

	-- Top bar
	local TopBar = Create("Frame", {
		Parent = Window,
		Name = "TopBar",
		Size = UDim2.new(1, 0, 0, 56),
		BackgroundColor3 = THEME.TopBar,
		BorderSizePixel = 0,
	})
	Create("UICorner", {Parent = TopBar, CornerRadius = UDim.new(0, 14)})
	MakeDraggable(TopBar, Window)

	-- Icon circle
	local Icon = Create("ImageLabel", {
		Parent = TopBar,
		Name = "Icon",
		Size = UDim2.fromOffset(36, 36),
		Position = UDim2.fromOffset(12, 10),
		BackgroundTransparency = 1,
		Image = IconId,
	})
	Create("UICorner", {Parent = Icon, CornerRadius = UDim.new(1, 0)})

	-- Title Labels
	local TitleLabel = Create("TextLabel", {
		Parent = TopBar,
		Name = "TitleLabel",
		Size = UDim2.new(1, -200, 0, 22),
		Position = UDim2.fromOffset(56, 6),
		BackgroundTransparency = 1,
		Text = Title,
		TextColor3 = THEME.Text,
		Font = Enum.Font.GothamBold,
		TextSize = 16,
		TextXAlignment = Enum.TextXAlignment.Left,
	})
	local SubLabel = Create("TextLabel", {
		Parent = TopBar,
		Name = "SubLabel",
		Size = UDim2.new(1, -200, 0, 18),
		Position = UDim2.fromOffset(56, 28),
		BackgroundTransparency = 1,
		Text = Author .. " | v" .. Version,
		TextColor3 = THEME.Muted,
		Font = Enum.Font.Gotham,
		TextSize = 13,
		TextXAlignment = Enum.TextXAlignment.Left,
	})

	-- Minimize & Close
	local Minimize = Create("TextButton", {
		Parent = TopBar,
		Name = "Minimize",
		Size = UDim2.fromOffset(36, 36),
		Position = UDim2.new(1, -92, 0.5, -18),
		BackgroundColor3 = Color3.fromRGB(25, 25, 30),
		Text = "—",
		Font = Enum.Font.GothamBold,
		TextSize = 20,
		TextColor3 = THEME.Text,
	})
	Create("UICorner", {Parent = Minimize, CornerRadius = UDim.new(1, 0)})

	local Close = Create("TextButton", {
		Parent = TopBar,
		Name = "Close",
		Size = UDim2.fromOffset(36, 36),
		Position = UDim2.new(1, -44, 0.5, -18),
		BackgroundColor3 = Color3.fromRGB(25, 25, 30),
		Text = "✕",
		Font = Enum.Font.GothamBold,
		TextSize = 18,
		TextColor3 = Color3.fromRGB(255, 90, 90),
	})
	Create("UICorner", {Parent = Close, CornerRadius = UDim.new(1, 0)})

	-- Left Tab column
	local LeftCol = Create("Frame", {
		Parent = Window,
		Name = "LeftCol",
		Size = UDim2.new(0, 220, 1, -56),
		Position = UDim2.fromOffset(0, 56),
		BackgroundColor3 = Color3.fromRGB(22, 22, 26),
		BorderSizePixel = 0,
	})
	Create("UICorner", {Parent = LeftCol, CornerRadius = UDim.new(0, 12)})

	local LeftList = Create("ScrollingFrame", {
		Parent = LeftCol,
		Name = "LeftList",
		Size = UDim2.fromScale(1, 1),
		BackgroundTransparency = 1,
		CanvasSize = UDim2.new(0, 0, 1, 0),
		ScrollBarThickness = 6,
	})
	local leftLayout = Create("UIListLayout", {Parent = LeftList})
	leftLayout.SortOrder = Enum.SortOrder.LayoutOrder
	leftLayout.Padding = UDim.new(0, 8)
	LeftList:GetPropertyChangedSignal("CanvasSize"):Connect(function() end)
	LeftList.AutomaticCanvasSize = Enum.AutomaticSize.Y

	-- Right content area
	local RightArea = Create("Frame", {
		Parent = Window,
		Name = "RightArea",
		Size = UDim2.new(1, -240, 1, -56),
		Position = UDim2.fromOffset(240, 56),
		BackgroundTransparency = 1,
	})

	-- Tabs container
	local TabContainer = Create("Frame", {
		Parent = RightArea,
		Name = "TabContainer",
		Size = UDim2.new(1, 0, 1, 0),
		BackgroundTransparency = 1,
	})
	-- We'll manage tab pages inside TabContainer

	-- MiniButton (60x60) shown when minimized
	local MiniButton = Create("ImageButton", {
		Parent = ScreenGui,
		Name = "MiniButton",
		Size = UDim2.fromOffset(60, 60),
		Position = UDim2.fromScale(0.1, 0.1),
		AnchorPoint = Vector2.new(0.5, 0.5),
		BackgroundColor3 = Color3.fromRGB(20, 20, 25),
		BorderSizePixel = 0,
		Visible = false,
		ZIndex = 999,
		Image = IconId or "",
	})
	Create("UICorner", {Parent = MiniButton, CornerRadius = UDim.new(0, 12)})
	MakeDraggable(MiniButton, MiniButton)

	-- Minimize behavior
	Minimize.MouseButton1Click:Connect(function()
		Window.Visible = false
		MiniButton.Visible = true
		MiniButton.Size = UDim2.fromOffset(0, 0)
		Tween(MiniButton, {Size = UDim2.fromOffset(60, 60)}, TweenInfo.new(0.28, Enum.EasingStyle.Back, Enum.EasingDirection.Out)):Play()
	end)
	MiniButton.MouseButton1Click:Connect(function()
		MiniButton.Visible = false
		Window.Visible = true
		Window.Size = UDim2.fromOffset(0, 0)
		Tween(Window, {Size = UDim2.fromOffset(780, 480)}, TweenInfo.new(0.28, Enum.EasingStyle.Back, Enum.EasingDirection.Out)):Play()
	end)

	-- Close confirmation
	local function ShowCloseConfirm()
		Minimize.Active = false
		Close.Active = false
		local Overlay = Create("Frame", {
			Parent = Window,
			Size = UDim2.new(1,0,1,0),
			BackgroundColor3 = Color3.fromRGB(0,0,0),
			BackgroundTransparency = 0.6,
			ZIndex = 20,
		})
		local ConfirmWindow = Create("Frame", {
			Parent = Overlay,
			Size = UDim2.fromOffset(350, 150),
			Position = UDim2.fromScale(0.5, 0.5),
			AnchorPoint = Vector2.new(0.5,0.5),
			BackgroundColor3 = THEME.Panel,
			ZIndex = 21,
		})
		Create("UICorner", {Parent = ConfirmWindow, CornerRadius = UDim.new(0, 12)})
		local Text = Create("TextLabel", {
			Parent = ConfirmWindow,
			Size = UDim2.new(1, -32, 0, 56),
			Position = UDim2.fromOffset(16, 12),
			BackgroundTransparency = 1,
			Text = "Are you sure you want to close the UI?",
			TextColor3 = THEME.Text,
			Font = Enum.Font.GothamBold,
			TextSize = 16,
			TextWrapped = true,
		})
		local Buttons = Create("Frame", {
			Parent = ConfirmWindow,
			Size = UDim2.new(1, 0, 0, 44),
			Position = UDim2.new(0, 0, 1, -16),
			BackgroundTransparency = 1,
		})
		local layout = Create("UIListLayout", {Parent = Buttons})
		layout.FillDirection = Enum.FillDirection.Horizontal
		layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
		layout.Padding = UDim.new(0, 12)
		local ConfirmBtn = Create("TextButton", {
			Parent = Buttons,
			Size = UDim2.fromOffset(120, 36),
			BackgroundColor3 = THEME.Accent,
			Text = "Confirm",
			Font = Enum.Font.GothamBold,
			TextColor3 = THEME.Text,
			TextSize = 14,
		})
		Create("UICorner", {Parent = ConfirmBtn, CornerRadius = UDim.new(0, 8)})
		local CancelBtn = Create("TextButton", {
			Parent = Buttons,
			Size = UDim2.fromOffset(120, 36),
			BackgroundColor3 = Color3.fromRGB(45,45,50),
			Text = "Cancel",
			Font = Enum.Font.GothamBold,
			TextColor3 = THEME.Text,
			TextSize = 14,
		})
		Create("UICorner", {Parent = CancelBtn, CornerRadius = UDim.new(0, 8)})

		ConfirmBtn.MouseButton1Click:Connect(function()
			ScreenGui:Destroy()
		end)
		CancelBtn.MouseButton1Click:Connect(function()
			Overlay:Destroy()
			Minimize.Active = true
			Close.Active = true
		end)
	end
	Close.MouseButton1Click:Connect(ShowCloseConfirm)

	-- Internal data
	local tabs = {} -- order-preserving list
	local activeTab = nil

	-- Utility: create left tab button
	local function CreateTabButton(title, icon)
		local btn = Create("TextButton", {
			Parent = LeftList,
			Size = UDim2.new(1, -24, 0, 40),
			BackgroundTransparency = 1,
			Text = "",
		})
		local frame = Create("Frame", {
			Parent = btn,
			Size = UDim2.new(1,0,1,0),
			BackgroundColor3 = Color3.fromRGB(28,28,32),
			BorderSizePixel = 0,
		})
		Create("UICorner", {Parent = frame, CornerRadius = UDim.new(0,8)})
		local stroke = Create("UIStroke", {Parent = frame, Color = Color3.fromRGB(0,110,180), Thickness = 0.9})
		stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
		local h = Create("Frame", {Parent = frame, Size = UDim2.new(0, 4, 1, 0), BackgroundColor3 = Color3.fromRGB(0,160,255), BorderSizePixel = 0})
		h.Visible = false
		local iconImg = Create("ImageLabel", {Parent = frame, Size = UDim2.fromOffset(24,24), Position = UDim2.fromOffset(10,8), BackgroundTransparency = 1, Image = icon or ""})
		local label = Create("TextLabel", {Parent = frame, Size = UDim2.new(1, -42, 1, 0), Position = UDim2.fromOffset(40,0), BackgroundTransparency = 1, Text = title, TextColor3 = THEME.Text, Font = Enum.Font.Gotham, TextSize = 14, TextXAlignment = Enum.TextXAlignment.Left})
		return btn, frame, h
	end

	-- Create new Tab (public)
	local function AddTab(title, icon)
		local tab = {
			Title = title or "Tab",
			Icon = FormatImage(icon or ""),
			Sections = {},
		}
		-- create left button
		local btn, frame, accent = CreateTabButton(tab.Title, tab.Icon)
		-- create page frame
		local page = Create("Frame", {Parent = TabContainer, Size = UDim2.new(1, 0, 1, 0), BackgroundTransparency = 1, Visible = false, Name = tab.Title})
		-- inside page, we have a scrolling content which stacks sections vertically
		local scroll = Create("ScrollingFrame", {Parent = page, Size = UDim2.new(1,1,1,0), BackgroundTransparency = 1, ScrollBarThickness = 8, CanvasSize = UDim2.new(0,0,0,0)})
		scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
		local layout = Create("UIListLayout", {Parent = scroll})
		layout.Padding = UDim.new(0, 12)
		layout.SortOrder = Enum.SortOrder.LayoutOrder

		-- Tab object methods
		function tab:SetActive()
			-- deactivate others
			for _, t in pairs(tabs) do
				if t.ButtonFrame and t.ButtonAccent then
					t.ButtonFrame.BackgroundColor3 = Color3.fromRGB(28,28,32)
					t.ButtonAccent.Visible = false
					t.Page.Visible = false
					-- fade out
					pcall(function() Tween(t.Page, {BackgroundTransparency = 1}, TweenInfo.new(0.18)):Play() end)
				end
			end
			-- activate this
			tab.ButtonFrame.BackgroundColor3 = Color3.fromRGB(30,30,34)
			tab.ButtonAccent.Visible = true
			tab.Page.Visible = true
			tab.Page.BackgroundTransparency = 0
			activeTab = tab
		end

		function tab:AddSection(title)
			local section = {}
			section.Title = title or ""
			-- Section frame auto-sizing
			local secFrame = Create("Frame", {Parent = scroll, Size = UDim2.new(1, -24, 0, 36), BackgroundColor3 = THEME.Panel, BorderSizePixel = 0})
			Create("UICorner", {Parent = secFrame, CornerRadius = UDim.new(0, 10)})
			local secHeader = Create("TextLabel", {Parent = secFrame, Size = UDim2.new(1, -20, 0, 28), Position = UDim2.fromOffset(12, 6), BackgroundTransparency = 1, Text = section.Title, TextColor3 = THEME.Text, Font = Enum.Font.GothamBold, TextSize = 14, TextXAlignment = Enum.TextXAlignment.Left})
			-- container for elements
			local elementsHolder = Create("Frame", {Parent = secFrame, Size = UDim2.new(1, -24, 0, 0), Position = UDim2.fromOffset(12, 40), BackgroundTransparency = 1})
			local elemsLayout = Create("UIListLayout", {Parent = elementsHolder})
			elemsLayout.SortOrder = Enum.SortOrder.LayoutOrder
			elemsLayout.Padding = UDim.new(0, 8)
			elementsHolder.AutomaticSize = Enum.AutomaticSize.Y
			secFrame.AutomaticSize = Enum.AutomaticSize.Y

			-- element adders
			function section:AddLabel(text)
				local lbl = Create("TextLabel", {Parent = elementsHolder, Size = UDim2.new(1,0,0,20), BackgroundTransparency = 1, Text = text or "", TextColor3 = THEME.Text, Font = Enum.Font.Gotham, TextSize = 14, TextWrapped = true, TextXAlignment = Enum.TextXAlignment.Left})
				return lbl
			end

			function section:AddParagraph(text)
				local par = Create("TextLabel", {Parent = elementsHolder, Size = UDim2.new(1,0,0,60), BackgroundTransparency = 1, Text = text or "", TextColor3 = THEME.Muted, Font = Enum.Font.Gotham, TextSize = 13, TextWrapped = true, TextXAlignment = Enum.TextXAlignment.Left})
				return par
			end

			function section:AddDivider()
				local d = Create("Frame", {Parent = elementsHolder, Size = UDim2.new(1,0,0,2), BackgroundColor3 = Color3.fromRGB(40,40,44), BorderSizePixel = 0})
				Create("UICorner", {Parent = d, CornerRadius = UDim.new(0,2)})
				return d
			end

			function section:AddButton(text, callback)
				local btn = Create("TextButton", {Parent = elementsHolder, Size = UDim2.new(1,0,0,36), BackgroundColor3 = Color3.fromRGB(35,35,38), Text = text or "Button", TextColor3 = THEME.Text, Font = Enum.Font.GothamBold, TextSize = 14, BorderSizePixel = 0})
				Create("UICorner", {Parent = btn, CornerRadius = UDim.new(0,8)})
				btn.MouseEnter:Connect(function() Tween(btn, {BackgroundColor3 = Color3.fromRGB(40,40,44)}, TweenInfo.new(0.12)):Play() end)
				btn.MouseLeave:Connect(function() Tween(btn, {BackgroundColor3 = Color3.fromRGB(35,35,38)}, TweenInfo.new(0.12)):Play() end)
				btn.MouseButton1Click:Connect(function()
					pcall(callback)
				end)
				return btn
			end

			function section:AddToggle(text, default, callback)
				default = default and true or false
				local holder = Create("Frame", {Parent = elementsHolder, Size = UDim2.new(1,0,0,36), BackgroundTransparency = 1})
				local label = Create("TextLabel", {Parent = holder, Size = UDim2.new(1, -48, 1, 0), BackgroundTransparency = 1, Text = text or "Toggle", TextColor3 = THEME.Text, Font = Enum.Font.Gotham, TextSize = 14, TextXAlignment = Enum.TextXAlignment.Left})
				local togg = Create("Frame", {Parent = holder, Size = UDim2.fromOffset(36, 20), Position = UDim2.new(1, -44, 0.5, -10), BackgroundColor3 = default and THEME.Accent or Color3.fromRGB(50,50,55), BorderSizePixel = 0})
				Create("UICorner", {Parent = togg, CornerRadius = UDim.new(0, 16)})
				local knob = Create("Frame", {Parent = togg, Size = UDim2.fromOffset(16,16), Position = default and UDim2.fromOffset(20,2) or UDim2.fromOffset(2,2), BackgroundColor3 = Color3.fromRGB(240,240,240), BorderSizePixel = 0})
				Create("UICorner", {Parent = knob, CornerRadius = UDim.new(1,0)})
				local state = default
				local function SetState(s)
					state = s
					if state then
						Tween(togg, {BackgroundColor3 = THEME.Accent}):Play()
						Tween(knob, {Position = UDim2.fromOffset(20,2)}):Play()
					else
						Tween(togg, {BackgroundColor3 = Color3.fromRGB(50,50,55)}):Play()
						Tween(knob, {Position = UDim2.fromOffset(2,2)}):Play()
					end
					pcall(callback, state)
				end
				togg.InputBegan:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
						SetState(not state)
					end
				end)
				return {
					Frame = holder,
					Set = SetState,
					Get = function() return state end,
				}
			end

			function section:AddTextbox(placeholder, callback)
				local box = Create("Frame", {Parent = elementsHolder, Size = UDim2.new(1,0,0,36), BackgroundTransparency = 1})
				local input = Create("TextBox", {Parent = box, Size = UDim2.new(1,0,0,36), BackgroundColor3 = Color3.fromRGB(35,35,38), Text = "", PlaceholderText = placeholder or "", TextColor3 = THEME.Text, Font = Enum.Font.Gotham, TextSize = 14, ClearTextOnFocus = false, BorderSizePixel = 0})
				Create("UICorner", {Parent = input, CornerRadius = UDim.new(0,8)})
				input.Focused:Connect(function()
					input.TextColor3 = THEME.Text
				end)
				input.FocusLost:Connect(function(enter)
					pcall(callback, input.Text, enter)
				end)
				return input
			end

			function section:AddSlider(text, min, max, default, step, callback)
				min = min or 0; max = max or 100; default = default or min; step = step or 1
				local holder = Create("Frame", {Parent = elementsHolder, Size = UDim2.new(1,0,0,56), BackgroundTransparency = 1})
				local label = Create("TextLabel", {Parent = holder, Size = UDim2.new(1,-12,0,18), Position = UDim2.fromOffset(6,2), BackgroundTransparency = 1, Text = text or "Slider", TextColor3 = THEME.Text, Font = Enum.Font.Gotham, TextSize = 13, TextXAlignment = Enum.TextXAlignment.Left})
				local valLabel = Create("TextLabel", {Parent = holder, Size = UDim2.new(0,60,0,18), Position = UDim2.new(1,-66,0,2), BackgroundTransparency = 1, Text = tostring(default), TextColor3 = THEME.Muted, Font = Enum.Font.GothamBold, TextSize = 13})
				local bar = Create("Frame", {Parent = holder, Size = UDim2.new(1,-12,0,12), Position = UDim2.fromOffset(6,26), BackgroundColor3 = Color3.fromRGB(45,45,50), BorderSizePixel = 0})
				Create("UICorner", {Parent = bar, CornerRadius = UDim.new(0,6)})
				local fill = Create("Frame", {Parent = bar, Size = UDim2.new( (default-min)/(max-min), 0, 1, 0), BackgroundColor3 = THEME.Accent, BorderSizePixel = 0})
				Create("UICorner", {Parent = fill, CornerRadius = UDim.new(0,6)})
				local dragging = false
				local function setValueFromX(x)
					local rel = math.clamp((x - bar.AbsolutePosition.X) / bar.AbsoluteSize.X, 0, 1)
					local raw = min + rel * (max - min)
					local stepped = math.floor((raw - min) / step + 0.5) * step + min
					stepped = math.clamp(stepped, min, max)
					fill.Size = UDim2.new((stepped - min)/(max-min), 0, 1, 0)
					valLabel.Text = tostring(stepped)
					pcall(callback, stepped)
				end
				bar.InputBegan:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
						dragging = true
						setValueFromX(input.Position.X)
					end
				end)
				bar.InputEnded:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
						dragging = false
					end
				end)
				UIS.InputChanged:Connect(function(input)
					if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
						setValueFromX(input.Position.X)
					end
				end)
				-- init
				setValueFromX(bar.AbsolutePosition.X + bar.AbsoluteSize.X * ((default-min)/(max-min)))
				return {
					Frame = holder,
					Set = function(v) setValueFromX(bar.AbsolutePosition.X + bar.AbsoluteSize.X * ((v-min)/(max-min))) end,
				}
			end

			function section:AddDropdown(text, options, callback)
				options = options or {}
				local holder = Create("Frame", {Parent = elementsHolder, Size = UDim2.new(1,0,0,36), BackgroundTransparency = 1})
				local label = Create("TextLabel", {Parent = holder, Size = UDim2.new(1,-36,1,0), BackgroundTransparency = 1, Text = text or "Dropdown", TextColor3 = THEME.Text, Font = Enum.Font.Gotham, TextSize = 14, TextXAlignment = Enum.TextXAlignment.Left})
				local arrow = Create("TextLabel", {Parent = holder, Size = UDim2.fromOffset(22,22), Position = UDim2.new(1,-30,0.5,-11), BackgroundColor3 = Color3.fromRGB(35,35,38), Text = "▾", TextColor3 = THEME.Text, Font = Enum.Font.Gotham, TextSize = 16, BorderSizePixel = 0})
				Create("UICorner", {Parent = arrow, CornerRadius = UDim.new(0,6)})
				local open = false
				local listFrame = Create("Frame", {Parent = holder, Size = UDim2.new(1,0,0,0), Position = UDim2.new(0,1,1,6), BackgroundColor3 = Color3.fromRGB(34,34,38), BorderSizePixel = 0, ClipsDescendants = true})
				Create("UICorner", {Parent = listFrame, CornerRadius = UDim.new(0,8)})
				local canvas = Create("ScrollingFrame", {Parent = listFrame, Size = UDim2.new(1,1,1,0), BackgroundTransparency = 1, ScrollBarThickness = 8})
				canvas.AutomaticCanvasSize = Enum.AutomaticSize.Y
				local layout = Create("UIListLayout", {Parent = canvas})
				layout.SortOrder = Enum.SortOrder.LayoutOrder
				layout.Padding = UDim.new(0,6)
				local current = nil
				local function populate()
					for _, v in pairs(canvas:GetChildren()) do
						if not v:IsA("UIListLayout") then v:Destroy() end
					end
					local posY = 8
					for i, opt in ipairs(options) do
						local optBtn = Create("TextButton", {Parent = canvas, Size = UDim2.new(1,-12,0,28), BackgroundColor3 = Color3.fromRGB(40,40,44), BorderSizePixel = 0, Text = tostring(opt), Font = Enum.Font.Gotham, TextColor3 = THEME.Text, TextSize = 13})
						Create("UICorner", {Parent = optBtn, CornerRadius = UDim.new(0,6)})
						optBtn.MouseButton1Click:Connect(function()
							current = opt
							label.Text = tostring(text) .. " - " .. tostring(opt)
							pcall(callback, opt)
							-- close
							open = false
							Tween(listFrame, {Size = UDim2.new(1,0,0,0)}):Play()
						end)
					end
					-- adjust listFrame size
					RunService.Heartbeat:Wait()
					local contentSize = canvas.CanvasSize.Y.Offset
					listFrame.Size = UDim2.new(1,0,0,math.clamp(contentSize + 12, 0, 250))
				end
				populate()
				holder.MouseButton1Click:Connect(function()
					if open then
						open = false
						Tween(listFrame, {Size = UDim2.new(1,0,0,0)}):Play()
					else
						open = true
						Tween(listFrame, {Size = UDim2.new(1,0,0,math.clamp(canvas.CanvasSize.Y.Offset + 12, 0, 250))}, TweenInfo.new(0.18, Enum.EasingStyle.Back, Enum.EasingDirection.Out)):Play()
					end
				end)
				return {
					Frame = holder,
					SetOptions = function(newOptions)
						options = newOptions or {}
						populate()
					end,
					Get = function() return current end,
				}
			end

			function section:AddKeybind(text, defaultKey, callback)
				local holder = Create("Frame", {Parent = elementsHolder, Size = UDim2.new(1,0,0,36), BackgroundTransparency = 1})
				local label = Create("TextLabel", {Parent = holder, Size = UDim2.new(1,-120,1,0), BackgroundTransparency = 1, Text = text or "Keybind", TextColor3 = THEME.Text, Font = Enum.Font.Gotham, TextSize = 14, TextXAlignment = Enum.TextXAlignment.Left})
				local keyBtn = Create("TextButton", {Parent = holder, Size = UDim2.new(0,100,0,28), Position = UDim2.new(1,-106,0.5,-14), BackgroundColor3 = Color3.fromRGB(40,40,44), Text = tostring(defaultKey or "None"), TextColor3 = THEME.Text, Font = Enum.Font.GothamBold, TextSize = 13})
				Create("UICorner", {Parent = keyBtn, CornerRadius = UDim.new(0,6)})
				local bound = defaultKey
				local capturing = false
				keyBtn.MouseButton1Click:Connect(function()
					capturing = true
					keyBtn.Text = "..."
					local conn
					conn = UIS.InputBegan:Connect(function(input, gameProcessed)
						if capturing then
							if input.UserInputType == Enum.UserInputType.Keyboard then
								bound = input.KeyCode
								keyBtn.Text = tostring(bound):gsub("Enum.KeyCode.", "")
								pcall(callback, bound)
								capturing = false
								conn:Disconnect()
							elseif input.UserInputType == Enum.UserInputType.Touch then
								-- mobile: assign "Touch" pseudo-key
								bound = "Touch"
								keyBtn.Text = "Touch"
								pcall(callback, bound)
								capturing = false
								conn:Disconnect()
							end
						end
					end)
				end)
				-- global trigger
				local activatedConn
				activatedConn = UIS.InputBegan:Connect(function(input, processed)
					if processed then return end
					if bound and typeof(bound) == "EnumItem" and input.KeyCode == bound then
						pcall(callback)
					elseif bound == "Touch" and input.UserInputType == Enum.UserInputType.Touch then
						pcall(callback)
					end
				end)
				return {
					Frame = holder,
					Set = function(k) bound = k; keyBtn.Text = tostring(k):gsub("Enum.KeyCode.", "") end,
					Get = function() return bound end,
					Disconnect = function() if activatedConn then activatedConn:Disconnect() end end,
				}
			end

			function section:AddColorPicker(text, defaultColor, callback)
				local holder = Create("Frame", {Parent = elementsHolder, Size = UDim2.new(1,0,0,36), BackgroundTransparency = 1})
				local label = Create("TextLabel", {Parent = holder, Size = UDim2.new(1,-80,1,0), BackgroundTransparency = 1, Text = text or "Color", TextColor3 = THEME.Text, Font = Enum.Font.Gotham, TextSize = 14, TextXAlignment = Enum.TextXAlignment.Left})
				local swatch = Create("Frame", {Parent = holder, Size = UDim2.fromOffset(36, 24), Position = UDim2.new(1, -44, 0.5, -12), BackgroundColor3 = defaultColor or Color3.fromRGB(255,255,255), BorderSizePixel = 0})
				Create("UICorner", {Parent = swatch, CornerRadius = UDim.new(0,6)})
				local open = false
				local picker = Create("Frame", {Parent = holder, Size = UDim2.new(0, 220, 0, 160), Position = UDim2.new(1, 10, 0, 30), BackgroundColor3 = THEME.Panel, Visible = false})
				Create("UICorner", {Parent = picker, CornerRadius = UDim.new(0,10)})
				local hueBar = Create("Frame", {Parent = picker, Size = UDim2.new(0, 28/220, 1, -20), Position = UDim2.fromOffset(8,10), BackgroundColor3 = Color3.fromRGB(255,0,0)})
				local satVal = Create("Frame", {Parent = picker, Size = UDim2.new(1, -56, 1, -20), Position = UDim2.fromOffset(40,10), BackgroundColor3 = Color3.fromRGB(255,0,0)})
				satVal.ClipsDescendants = true
				local svIndicator = Create("Frame", {Parent = satVal, Size = UDim2.fromScale(0.04,0.04), BackgroundColor3 = Color3.new(1,1,1)})
				Create("UICorner", {Parent = svIndicator, CornerRadius = UDim.new(1,0)})
				-- We'll use HSV math
				local hue = 0
				local sat = 1
				local val = 1
				local function HSVToColor()
					return Color3.fromHSV(hue, sat, val)
				end
				local function updateSwatch()
					swatch.BackgroundColor3 = HSVToColor()
					pcall(callback, HSVToColor())
				end
				-- Simple hue gradient
				local grad = Create("UIGradient", {Parent = hueBar})
				grad.Rotation = 90
				grad.Color = ColorSequence.new{
					ColorSequenceKeypoint.new(0, Color3.fromHSV(0,1,1)),
					ColorSequenceKeypoint.new(0.17, Color3.fromHSV(0.17,1,1)),
					ColorSequenceKeypoint.new(0.34, Color3.fromHSV(0.34,1,1)),
					ColorSequenceKeypoint.new(0.51, Color3.fromHSV(0.51,1,1)),
					ColorSequenceKeypoint.new(0.68, Color3.fromHSV(0.68,1,1)),
					ColorSequenceKeypoint.new(0.85, Color3.fromHSV(0.85,1,1)),
					ColorSequenceKeypoint.new(1, Color3.fromHSV(1,1,1)),
				}
				-- satVal should have overlaying gradient for saturation/value
				local black = Create("Frame", {Parent = satVal, Size = UDim2.new(1,0,1,0), BackgroundColor3 = Color3.new(1,1,1)})
				local satGrad = Create("UIGradient", {Parent = black})
				satGrad.Color = ColorSequence.new{ ColorSequenceKeypoint.new(0, Color3.new(1,1,1)), ColorSequenceKeypoint.new(1, Color3.new(1,1,1)) }
				black.BackgroundTransparency = 0
				local blackOverlay = Create("Frame", {Parent = black, Size = UDim2.new(1,0,1,0), BackgroundColor3 = Color3.new(0,0,0), BackgroundTransparency = 1})
				-- very simple approach: clicking hue sets hue; clicking satVal adjusts sat & val
				hueBar.InputBegan:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
						local rel = math.clamp((input.Position.Y - hueBar.AbsolutePosition.Y) / hueBar.AbsoluteSize.Y, 0, 1)
						hue = 1 - rel
						updateSwatch()
					end
				end)
				satVal.InputBegan:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
						local rx = math.clamp((input.Position.X - satVal.AbsolutePosition.X) / satVal.AbsoluteSize.X, 0, 1)
						local ry = math.clamp((input.Position.Y - satVal.AbsolutePosition.Y) / satVal.AbsoluteSize.Y, 0, 1)
						sat = rx
						val = 1 - ry
						updateSwatch()
						svIndicator.Position = UDim2.new(rx, -4, 1-ry, -4)
					end
				end)
				swatch.MouseButton1Click:Connect(function()
					open = not open
					picker.Visible = open
				end)
				-- init default
				if defaultColor then
					local h,s,v = Color3.toHSV(defaultColor)
					hue, sat, val = h, s, v
					updateSwatch()
					svIndicator.Position = UDim2.new(sat, -4, 1-val, -4)
				end

				return {
					Frame = holder,
					SetColor = function(c) local h,s,v = Color3.toHSV(c); hue, sat, val = h,s,v; updateSwatch() end,
					Get = function() return HSVToColor() end,
				}
			end

			-- Append section to tab
			table.insert(tab.Sections, section)
			section._Frame = secFrame
			return section
		end

		-- attach references
		tab.Button = btn
		tab.ButtonFrame = frame
		tab.ButtonAccent = accent
		tab.Page = page

		-- clicking tab
		btn.MouseButton1Click:Connect(function()
			tab:SetActive()
		end)

		-- store and return
		table.insert(tabs, tab)
		-- if first tab, activate
		if #tabs == 1 then
			tab:SetActive()
		end
		return tab
	end

	-- Public API
	local API = {}
	function API:AddTab(title, icon)
		return AddTab(title, icon)
	end
	function API:GetTabs()
		return tabs
	end
	function API:Destroy()
		if ScreenGui and ScreenGui.Parent then
			ScreenGui:Destroy()
		end
	end
	-- convenience: pre-create tabs if provided
	if config.Tabs and type(config.Tabs) == "table" then
		for _, t in ipairs(config.Tabs) do
			AddTab(t.Title, t.Icon)
		end
	end

	-- Return handles & API
	local handles = {
		ScreenGui = ScreenGui,
		Window = Window,
		TopBar = TopBar,
		Icon = Icon,
		TitleLabel = TitleLabel,
		SubLabel = SubLabel,
		LeftList = LeftList,
		TabContainer = TabContainer,
		MiniButton = MiniButton,
		API = API,
	}
	return handles
end

return ExecutorUI
